<html>

<head>
    <title>Three.js Geometries Example</title>
</head>

<body>

    <canvas id="myCanvas" width="800" height="800"></canvas>

    <script type="module">
        import * as THREE from "http://cs.merrimack.edu/~stuetzlec/three.js-master/build/three.module.js";
        import { PointerLockControls } from 'http://cs.merrimack.edu/~stuetzlec/three.js-master/examples/jsm/controls/PointerLockControls.js';


        var scene = new THREE.Scene();

        let sunColors = [0xf7e2ba, 0xffdaa8, 0xf8cb7c, 0xfdb25b, 0xfa9e4d];
        let moonColor = [0xdde2e5];
        let skyColors = [0x000608, 0x072f41, 0x094f6d, 0x436e91, 0x5e88b8, 0x7998bb];

        let windowWidth = window.innerWidth;
        let windowHeight = window.innerHeight;


        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 500);
        camera.lookAt(new THREE.Vector3(0.0, 0.0, 0.0));
        camera.position.set(0, 2, 10);
        scene.add(camera);
        let previousTime = performance.now();

        var renderer = new THREE.WebGLRenderer({ canvas: myCanvas, antialias: true });
        renderer.setClearColor(0xADD8E6);
        // If you want this to span the window, instead of using the myCanvas object, use the window object
        renderer.setPixelRatio(document.getElementById('myCanvas').devicePixelRatio);
        // If you want the render to span the window, uncomment this
        renderer.setSize(window.innerWidth, window.innerHeight);
        //renderer.shadowMap.enable = true;

        var controls = new PointerLockControls(camera, document.body);

        document.addEventListener('click', function () {
            controls.lock();
        });

        //Src : https://threejs.org/examples/?q=light#webgl_lights_physical


        function makeLights(hexCode, x, y, z) {
            //Creates a sphere and pointlight and adds them both to the scene
            renderer.setClearColor(0x000608);
            const bulbGeometry = new THREE.SphereGeometry(0.4, 32, 16);
            let bulbLight = new THREE.PointLight(hexCode, .5, 100); //Creates point light
            //color of the light being directed
            let bulbMat = new THREE.MeshStandardMaterial({ //Creates bulb material for the light
                emissive: hexCode, //color of the bulb
                emissiveIntensity: 1,
                color: 0xffff00
            });
            bulbLight.add(new THREE.Mesh(bulbGeometry, bulbMat)); //Adds bulb geometry and bulb light to the point light
            bulbLight.position.set(x, y, z); //Positions the bulblight 
            bulbLight.castShadow = true; //Casts shadow from the bulb light
            scene.add(bulbLight); //Adds bulb light to the scene
            return bulbLight;
        }

        // makeLights(0xacdef3, 0);

        //makeLights(skyColors[4], 4);
        let moon = makeLights(moonColor[0], -4, -5, 0);
        let sun = makeLights(sunColors[4], 4, 5, 0);




        const geometry = new THREE.PlaneGeometry(10, 10);
        const material = new THREE.MeshPhongMaterial({ color: 0x90EE90, side: THREE.DoubleSide });
        const plane = new THREE.Mesh(geometry, material);
        plane.position.set(0.0, -0.5, 0.0);
        plane.rotation.x = Math.PI / 2;
        scene.add(plane);
        let turnSpeed = .1;

        function rotateAboutWorldAxis(object, axis, angle) {
            var rotationMatrix = new THREE.Matrix4();
            rotationMatrix.makeRotationAxis(axis.normalize(), angle);
            var currentPos = new THREE.Vector4(object.position.x, object.position.y, object.position.z, 1);
            var newPos = currentPos.applyMatrix4(rotationMatrix);
            object.position.x = newPos.x;
            object.position.y = newPos.y;
            object.position.z = newPos.z;
        }


        function checkPositions(sun, moon){
            if(moon.position.y > 4){
                console.log("highest");
                moon.intensity = .8;
            }
            else if(3 <= moon.position.y && moon.position.y < 4){
                console.log("high");
                moon.intensity = .7;
            }
            else if(2 <= moon.position.y && moon.position.y < 3){
                console.log("mid");
                moon.intensity = .6;
            }
            else if(1 <= moon.position.y && moon.position.y < 2){
                console.log("low");
                moon.intensity = .5;
            }
            else if(moon.position.y < 1){
                console.log("lowest");
                moon.intensity = .4;
            }

        
            //sunset
            //sunrise

        }




        function render() {
            updateSize();
            requestAnimationFrame(render);

            const time = performance.now();

            const delta = time - previousTime;

            

            // We need to translate the object back to the origin before rotating it:
            rotateAboutWorldAxis(sun, new THREE.Vector3(0.0, 0.0, 1.0),  turnSpeed*.05);
            rotateAboutWorldAxis(moon, new THREE.Vector3(0.0, 0.0, 1.0),  turnSpeed*.05);
            checkPositions(sun, moon);

            

            // Rotate while we rotate:
            //moon.rotateX(turnSpeed * 0.1);

            // // If we're rotating the camera change that here.
            // if (animateRotation)
            //     // The applyAxisAngle method rotates about an axis in space
            //     camera.position.applyAxisAngle(new THREE.Vector3(0.0, 1.0, 0.0), turnSpeed * 0.1);
            // if (animateOtherRotation)
            //     camera.position.applyAxisAngle(new THREE.Vector3(0.0, 0.0, 1.0), turnSpeed * 0.1);

            // camera.lookAt(new THREE.Vector3(xLookAt, yLookAt, zLookAt));

            // requestAnimationFrame(animate);
            // renderer.render(scene, camera);

            previousTime = time;
            renderer.render(scene, camera);
        }


         //source: https://threejs.org/examples/webgl_multiple_views.html
        //This function updates the window width and height variables to the actual width and height of the computer
        //regardless of whether the console has been opened or not
        function updateSize() {
            if (windowWidth != window.innerWidth || windowHeight != window.innerHeight) { //If the window width or height has
                //actually been changed than this if statement is triggered
                windowWidth = window.innerWidth;
                windowHeight = window.innerHeight;
                renderer.setSize(windowWidth, windowHeight);
            }
        }



        function keyHandler(e) {
            switch (e.keyCode) {
                case 65: //L
                    break;
                case 68:

                    break;
                case 80:

                    break;
                case 83:




            }
        }

        document.addEventListener("keydown", keyHandler, false);


        render();
    </script>
</body>

</html>